<h2>Contact Us</h2>

<% if (error) { %>
  <p style="color: red;"><%= error %></p>
<% } %>

<% if (success) { %>
  <p style="color: green;"><%= success %></p>
<% } %>

<form id="contactForm" method="POST" action="/contact" novalidate>
  
  <label>Full Name:</label>
  <input type="text" name="name" id="name" required minlength="3" />
  <br />

  <label>Email:</label>
  <input type="email" name="email" id="email" required />
  <br />

  <label>Password:</label>
  <input type="password" name="password" id="password" required minlength="8" />
  <small id="passwordHelp" style="display:block; margin-bottom:1rem; color: gray;">
    Must be at least 8 characters, with uppercase, lowercase, number, and special character.
  </small>

  <!-- Password Strength Indicator -->
  <div id="strengthWrapper" style="margin-bottom: 1.5rem;">
    <div id="strengthBar" style="height: 10px; border-radius: 5px; background: #ddd;"></div>
    <p id="strengthText" style="font-size: 0.9rem; margin-top: 5px; font-weight: 600;"></p>
  </div>

  <label>Confirm Password:</label>
  <input type="password" name="confirmPassword" id="confirmPassword" required minlength="8" />
  <br />

  <label>Phone Number:</label>
  <input type="tel" name="phone" id="phone" pattern="[0-9]{10}" placeholder="10-digit number" />
  <br />

  <label>Subject:</label>
  <select name="subject" id="subject" required>
    <option value="">--Select--</option>
    <option value="general">General Inquiry</option>
    <option value="support">Technical Support</option>
    <option value="feedback">Feedback</option>
    <option value="other">Other</option>
  </select>
  <br />

  <label>Message:</label>
  <textarea name="message" id="message" required minlength="10"></textarea>
  <br />

  <label>Preferred Contact:</label>
  <input type="radio" name="contactMethod" value="email" checked /> Email
  <input type="radio" name="contactMethod" value="phone" /> Phone
  <br />

  <label>
    <input type="checkbox" name="newsletter" value="yes" />
    Subscribe to Newsletter
  </label>
  <br />

  <button type="submit">Send</button>
</form>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contactForm");

    const nameEl = document.getElementById("name");
    const emailEl = document.getElementById("email");
    const phoneEl = document.getElementById("phone");
    const subjectEl = document.getElementById("subject");
    const messageEl = document.getElementById("message");
    const passwordEl = document.getElementById("password");
    

    const strengthBar = document.getElementById("strengthBar");
    const strengthText = document.getElementById("strengthText");

    // Live password strength meter
    passwordEl.addEventListener("input", () => {
      const value = passwordEl.value;
      let strength = 0;

      if (value.length >= 8) strength++;
      if (/[A-Z]/.test(value)) strength++;
      if (/[a-z]/.test(value)) strength++;
      if (/\d/.test(value)) strength++;
      if (/[@$!%*?&]/.test(value)) strength++;

      if (strength <= 2) {
        strengthBar.style.width = "33%";
        strengthBar.style.background = "red";
        strengthText.textContent = "Weak ðŸ”´";
        strengthText.style.color = "red";
      } else if (strength <= 4) {
        strengthBar.style.width = "66%";
        strengthBar.style.background = "orange";
        strengthText.textContent = "Medium ðŸŸ ";
        strengthText.style.color = "orange";
      } else {
        strengthBar.style.width = "100%";
        strengthBar.style.background = "green";
        strengthText.textContent = "Strong ðŸŸ¢";
        strengthText.style.color = "green";
      }
    });

    // Submit validation
    form.addEventListener("submit", (e) => {
      const name = nameEl.value.trim();
      const email = emailEl.value.trim();
      const phone = phoneEl.value.trim();
      const subject = subjectEl.value;
      const message = messageEl.value.trim();
      const pwd = passwordEl.value;
      const confirmPwd = document.getElementById("confirmPassword").value;

      if (name.length < 3) { alert("Name must be at least 3 characters long."); e.preventDefault(); return; }
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) { alert("Please enter a valid email."); e.preventDefault(); return; }
      if (phone && !/^\d{10}$/.test(phone)) { alert("Phone number must be 10 digits."); e.preventDefault(); return; }
      if (!subject) { alert("Please select a subject."); e.preventDefault(); return; }
      if (message.length < 10) { alert("Message must be at least 10 characters long."); e.preventDefault(); return; }
      if (pwd !== confirmPwd) {
        alert("Passwords do not match!");
        e.preventDefault();
        return;
      }

      const strongPwd = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/;
      if (!strongPwd.test(pwd)) {
        alert("Password must be 8+ chars with uppercase, lowercase, number, special char.");
        e.preventDefault();
        return;
      }
    });
  });
</script>

